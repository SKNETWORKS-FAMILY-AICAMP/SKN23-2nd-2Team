import streamlit as st

# =========================
# ë©”ì‹œì§€ í…œí”Œë¦¿
# =========================
MESSAGE_TEMPLATES = {
    "ì˜ˆì•½ ì•ˆë‚´ (ê¸°ë³¸)": """ì•ˆë…•í•˜ì„¸ìš”. [ë³‘ì›ëª…]ì…ë‹ˆë‹¤.

[ê³ ê°ëª…]ë‹˜ì˜ ì˜ˆì•½ ì¼ì •ì„ ì•ˆë‚´ë“œë¦½ë‹ˆë‹¤.
ğŸ“… ì˜ˆì•½ì¼ì‹œ: [ì˜ˆì•½ì¼ì‹œ]
ğŸ¥ ì§„ë£Œê³¼ëª©: [ì§„ë£Œê³¼ëª©]

ì˜ˆì•½ ì‹œê°„ 10ë¶„ ì „ê¹Œì§€ ë‚´ì› ë¶€íƒë“œë¦½ë‹ˆë‹¤.
ì˜ˆì•½ ë³€ê²½ì´ í•„ìš”í•˜ì‹  ê²½ìš° ì—°ë½ ì£¼ì‹œê¸° ë°”ëë‹ˆë‹¤.

ê°ì‚¬í•©ë‹ˆë‹¤.""",

    "ì˜ˆì•½ í™•ì¸ ìš”ì²­": """[ê³ ê°ëª…]ë‹˜, ì•ˆë…•í•˜ì„¸ìš”.

ì˜ˆì•½í•˜ì‹  [ì˜ˆì•½ì¼ì‹œ] [ì§„ë£Œê³¼ëª©] ì§„ë£Œê°€ ê°€ëŠ¥í•˜ì‹ ì§€ í™•ì¸ ë¶€íƒë“œë¦½ë‹ˆë‹¤.

âœ… ì˜ˆì•½ ìœ ì§€
âŒ ì˜ˆì•½ ì·¨ì†Œ/ë³€ê²½ í•„ìš”

íšŒì‹  ë¶€íƒë“œë¦½ë‹ˆë‹¤.
ê°ì‚¬í•©ë‹ˆë‹¤.""",

    "ë…¸ì‡¼ ê²½ê³  (ê³ ìœ„í—˜)": """[ê³ ê°ëª…]ë‹˜, ì•ˆë…•í•˜ì„¸ìš”.

ì˜ˆì•½í•˜ì‹  [ì˜ˆì•½ì¼ì‹œ] [ì§„ë£Œê³¼ëª©] ì§„ë£Œì— ëŒ€í•œ í™•ì¸ì°¨ ì—°ë½ë“œë¦½ë‹ˆë‹¤.

âš ï¸ ì‚¬ì „ ì—°ë½ ì—†ì´ ì˜ˆì•½ì„ ì§€í‚¤ì§€ ì•Šìœ¼ì‹¤ ê²½ìš°,
í–¥í›„ ì˜ˆì•½ì— ì œí•œì´ ìˆì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ì˜ˆì•½ ë³€ê²½ì´ë‚˜ ì·¨ì†Œê°€ í•„ìš”í•˜ì‹  ê²½ìš°
ë¯¸ë¦¬ ì—°ë½ ì£¼ì‹œê¸° ë°”ëë‹ˆë‹¤.

ê°ì‚¬í•©ë‹ˆë‹¤.""",

    "ì§ì ‘ ì‘ì„±": ""
}

# =========================
# ë Œë” í•¨ìˆ˜
# =========================
def render_message_sender(customer: dict):
    st.subheader("ğŸ“© ë¬¸ì ì „ì†¡")
    st.caption("ì˜ˆì•½ í™•ì¸ ë° ë…¸ì‡¼ ì˜ˆë°© ë©”ì‹œì§€ë¥¼ ë°œì†¡í•©ë‹ˆë‹¤.")

    # -------------------------
    # ìˆ˜ì‹ ì ì •ë³´
    # -------------------------
    with st.container(border=True):
        st.markdown("**ìˆ˜ì‹ ì ì •ë³´**")
        st.write(f"- ê³ ê°ëª…: **{customer['name']}**")
        st.write(f"- ì—°ë½ì²˜: {customer['phone']}")
        st.write(f"- ì˜ˆì•½ì¼ì‹œ: {customer['lastAppointment']}")
        st.write(f"- ì§„ë£Œê³¼ëª©: {customer['department']}")

    st.divider()

    # -------------------------
    # í…œí”Œë¦¿ ì„ íƒ
    # -------------------------
    template_name = st.selectbox(
        "ë©”ì‹œì§€ í…œí”Œë¦¿ ì„ íƒ",
        list(MESSAGE_TEMPLATES.keys()),
    )

    # ì„¸ì…˜ ì´ˆê¸°í™”
    if "message_content" not in st.session_state:
        st.session_state.message_content = ""

    # í…œí”Œë¦¿ ë³€ê²½ ì‹œ ìë™ ì¹˜í™˜
    raw_template = MESSAGE_TEMPLATES[template_name]
    if raw_template:
        content = (
            raw_template
            .replace("[ê³ ê°ëª…]", customer["name"])
            .replace("[ì˜ˆì•½ì¼ì‹œ]", customer["lastAppointment"])
            .replace("[ì§„ë£Œê³¼ëª©]", customer["department"])
            .replace("[ë³‘ì›ëª…]", "OOë³‘ì›")
        )
        st.session_state.message_content = content

    # -------------------------
    # ë©”ì‹œì§€ ì…ë ¥
    # -------------------------
    message = st.text_area(
        "ë¬¸ì ë‚´ìš©",
        value=st.session_state.message_content,
        height=260,
        max_chars=2000
    )

    st.caption(f"{len(message)} / 2000ì")

    # -------------------------
    # ì•¡ì…˜ ë²„íŠ¼
    # -------------------------
    col_send, col_cancel = st.columns([1, 1])

    with col_send:
        if st.button("ğŸ“¤ ì „ì†¡í•˜ê¸°", type="primary"):
            if not message.strip():
                st.error("ë©”ì‹œì§€ ë‚´ìš©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.")
            else:
                # ì‹¤ì œ í™˜ê²½ì—ì„œëŠ” ë¬¸ì API í˜¸ì¶œ
                st.success(f"{customer['name']}ë‹˜ì—ê²Œ ë¬¸ìê°€ ë°œì†¡ë˜ì—ˆìŠµë‹ˆë‹¤.")

                # ìƒíƒœ ì´ˆê¸°í™”
                st.session_state.message_content = ""

    with col_cancel:
        if st.button("ì·¨ì†Œ"):
            st.session_state.message_content = ""
            st.info("ë¬¸ì ì „ì†¡ì„ ì·¨ì†Œí–ˆìŠµë‹ˆë‹¤.")
